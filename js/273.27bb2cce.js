"use strict";(self["webpackChunkshopping_mall23"]=self["webpackChunkshopping_mall23"]||[]).push([[273],{1817:function(s,t,o){o.d(t,{A:function(){return l}});var e=function(){var s=this,t=s._self._c;return t("div",{staticClass:"commentsList"},s._l(s.comments,(function(o,e){return t("div",{key:o.comment_id,staticClass:"onecomment"},[t("div",{staticClass:"ocTop"},[t("img",{attrs:{src:o.user.avatar_url}}),t("span",[s._v(s._s(o.user.nick_name))]),t("div",{staticClass:"rateShow"},[t("van-rate",{attrs:{readonly:"",color:"#f4a213"},model:{value:s.scores[e],callback:function(t){s.$set(s.scores,e,t)},expression:"scores[index]"}})],1)]),t("div",{staticClass:"ocMain text-ellipsis-2"},[s._v(" "+s._s(o.content)+" ")]),t("div",{staticClass:"ocFooter"},[s._v(s._s(o.create_time))])])})),0)},a=[],n={data(){return{scores:this.commentsScores}},props:{comments:{type:Array,require:!0},commentsScores:{type:Array,require:!0}},created(){console.log("Yes"),console.log(this.comments),console.log(this.commentsScores)},watch:{commentsScores(s){console.log("change"),this.scores=s}}},i=n,c=o(1656),r=(0,c.A)(i,e,a,!1,null,"eb7ee08c",null),l=r.exports},3273:function(s,t,o){o.r(t),o.d(t,{default:function(){return h}});o(4114);var e=function(){var s=this,t=s._self._c;return t("div",{staticClass:"prodetail"},[t("van-nav-bar",{staticClass:"test1",attrs:{title:"商品详情","left-arrow":"",fixed:"",placeholder:""},on:{"click-left":function(t){return s.$router.go(-1)}}}),t("div",{staticClass:"picShow"},[t("van-swipe",{attrs:{loop:!1},on:{change:s.onChange},scopedSlots:s._u([{key:"indicator",fn:function(){return[s.showPics?t("div",{staticClass:"custom-indicator"},[s._v(" "+s._s(s.currentPic+1)+"/"+s._s(s.showPics.length)+" ")]):s._e()]},proxy:!0}])},s._l(s.showPics,(function(s){return t("van-swipe-item",{key:s.file_id},[t("img",{attrs:{src:s.external_url}})])})),1)],1),t("div",{staticClass:"goodsDetail"},[t("div",[t("div",{staticClass:"priceAndsales"},[t("div",[t("span",{staticClass:"current-price"},[s._v("￥"+s._s(s.goodsInfo.goods_price_max))]),t("span",{staticClass:"original-price"},[s._v("￥"+s._s(s.goodsInfo.line_price_max))])]),t("span",{staticClass:"goods-sales"},[s._v("已售"+s._s(s.goodsInfo.goods_sales))])]),t("div",{staticClass:"name"},[t("span",{staticClass:"goods-name text-ellipsis-2"},[s._v(s._s(s.goodsInfo.goods_name))])])])]),s.serviceList.length>0?t("div",{staticClass:"serves"},[s._l(2,(function(o){return t("div",{key:o,staticClass:"oneserve"},[t("van-icon",{attrs:{name:"passed"}}),t("span",[s._v(s._s(s.serviceList[o-1].name))])],1)})),t("span",{staticClass:"arrows",on:{click:function(t){s.serveSheetShow=!0}}},[s._v(" 共"+s._s(s.serviceList.length)+"项 "),t("van-icon",{attrs:{name:"arrow"}})],1)],2):s._e(),t("div",{staticClass:"comments"},[t("div",{staticClass:"comTop"},[t("span",[s._v("商品评论("+s._s(s.commentsCount)+"条)")]),t("span",{on:{click:function(t){return s.$router.push(`/comment?id=${s.goodsId}&type=-1`)}}},[s._v("查看更多"),t("van-icon",{attrs:{name:"arrow"}})],1)]),t("commentsList",{attrs:{comments:s.comments,commentsScores:s.commentsScores}})],1),t("div",{staticClass:"prodescribe"},[t("span",[s._v("商品描述")]),s._l(s.showPics,(function(s){return t("img",{key:s.file_id,attrs:{src:s.external_url}})}))],2),t("div",{staticClass:"Footer"},[t("div",{staticClass:"toHome UpAndDown"},[t("van-icon",{attrs:{name:"wap-home-o"}}),t("span",[s._v("主页")])],1),t("div",{staticClass:"toCart UpAndDown"},[t("van-icon",{attrs:{name:"shopping-cart-o"}}),t("span",[s._v("购物车")])],1),t("button",{staticClass:"addCart",on:{click:function(t){s.sheetShow=!0,s.isAddToCart=!0}}},[s._v(" 加入购物车 ")]),t("button",{staticClass:"buy",on:{click:function(t){s.sheetShow=!0,s.isAddToCart=!1}}},[s._v(" 立即购买 ")])]),t("div",{staticClass:"ServeSheet"},[t("van-action-sheet",{attrs:{actions:s.actions,description:"所有服务","close-on-click-action":""},model:{value:s.serveSheetShow,callback:function(t){s.serveSheetShow=t},expression:"serveSheetShow"}})],1),t("div",{staticClass:"CartSheet"},[t("van-action-sheet",{attrs:{title:s.sheetTitle,"cancel-text":s.sheetCancle,closeable:!1},on:{cancel:s.CartOrPay},model:{value:s.sheetShow,callback:function(t){s.sheetShow=t},expression:"sheetShow"}},[t("div",{staticClass:"content"},[t("div",{staticClass:"buyGoodsInfo"},[t("img",{attrs:{src:s.goodsInfo.goods_image}}),t("div",[t("span",{staticClass:"price"},[s._v("￥"+s._s(s.goodsInfo.goods_price_min))]),t("span",{staticClass:"allMounts"},[s._v("库存:"+s._s(s.goodsInfo.stock_total))])])]),t("div",{staticClass:"buyCounts"},[t("span",[s._v("数量")]),t("div",[t("CountBox",{attrs:{value:s.buyCounts},on:{add:s.addBuyCounts,sub:s.subBuyCounts}})],1)])])])],1)],1)},a=[],n=o(3428),i=o(9419),c=o(7382),r=o(1817),l={name:"prodetailIndex",components:{CountBox:c.A,CommentsList:r.A},data(){return{isAddToCart:!0,sheetShow:!1,serveSheetShow:!1,i:0,tmpRateValue:5,currentPic:0,goodsInfo:{},showPics:[],buyCounts:1,serviceList:[],comments:[],commentsCount:0,commentsScores:[]}},computed:{goodsId(){return this.$route.params.id},sheetTitle(){return this.isAddToCart?"购物车":"购买"},sheetCancle(){return 0===this.goodsInfo.stock_total?"商品已售罄":this.isAddToCart?"加入购物车":"立即购买"},actions(){return this.serviceList.map((s=>({name:s.name,subname:s.summary,color:"#ff5d33"})))}},async created(){await this.getGoodsInfo(),await this.setServiceList(),await this.setCommentsCount(),await this.setComments(),this.handleCommentsScores()},methods:{onChange(s){this.currentPic=s},async getGoodsInfo(){const s=await(0,n.j1)(this.goodsId);this.goodsInfo=s.data.detail,this.showPics=this.goodsInfo.goods_images,console.log("goodsInfo:"),console.log(this.goodsInfo)},async setServiceList(){const{data:{list:s}}=await(0,n.As)(this.goodsId);this.serviceList=s,console.log(this.serviceList)},async setCommentsCount(){const{data:{total:{all:s}}}=await(0,n.L)(this.goodsId);this.commentsCount=s},async setComments(){const{data:{list:s}}=await(0,n.Ck)(this.goodsId,2);this.comments=s},handleCommentsScores(){this.commentsScores=this.comments.map((s=>{switch(console.log(s.score),s.score){case 10:return 5;case 20:return 3;case 30:return 1;default:return 0}}))},CartOrPay(){if(0===this.goodsInfo.stock_total)return this.$toast("商品没有啦！"),void(this.sheetShow=!1);this.$store.getters.token||this.$dialog.confirm({message:"您还没有登录哦~",confirmButtonText:"去登录",cancelButtonText:"确定"}).then((()=>{this.$router.replace({path:`/login?forwardUrl=${this.$route.fullPath}`})})).catch((()=>{})),this.isAddToCart?((0,i.U4)(this.goodsInfo.goods_id,this.buyCounts),this.$toast("已加入购物车"),console.log("success"),this.sheetShow=!1):this.$router.push({path:"/pay",query:{mode:"buyNow",goodsInfo:{goodsId:this.goodsInfo.goods_id,goodsNum:this.buyCounts,goodsSkuId:0}}})},subBuyCounts(){this.buyCounts--},addBuyCounts(){this.buyCounts++}}},d=l,u=o(1656),m=(0,u.A)(d,e,a,!1,null,"c2a2cba8",null),h=m.exports},3428:function(s,t,o){o.d(t,{As:function(){return i},Ck:function(){return c},K4:function(){return a},L:function(){return r},j1:function(){return n}});var e=o(5720);const a=s=>{const{categoryId:t,goodsName:o,page:a}=s;return e.A.get("/goods/list",{params:{categoryId:t,goodsName:o,page:a}})},n=s=>e.A.get("/goods/detail",{params:{goodsId:s}}),i=s=>e.A.get("/goods.service/list",{params:{goodsId:s}}),c=(s,t)=>e.A.get("/comment/listRows",{params:{goodsId:s,limit:t}}),r=s=>e.A.get("/comment/total",{params:{goodsId:s}})}}]);
//# sourceMappingURL=273.27bb2cce.js.map