{"version":3,"file":"js/999.76e75896.js","mappings":"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","sources":["webpack://shopping_mall23/./src/views/address/edit_add.vue","webpack://shopping_mall23/src/views/address/edit_add.vue","webpack://shopping_mall23/./src/views/address/edit_add.vue?d882","webpack://shopping_mall23/./src/views/address/edit_add.vue?9606","webpack://shopping_mall23/./src/api/address/index.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"edit_add\"},[_c('van-nav-bar',{attrs:{\"title\":\"添加收货地址\",\"left-arrow\":\"\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-address-edit',{staticClass:\"myEdit\",attrs:{\"address-info\":_vm.addressDetail,\"area-list\":_vm.vantRegion,\"show-set-default\":!(_vm.addressId === _vm.defaultAddressId),\"area-value\":\"110000\",\"area-placeholder\":_vm.addressId\n        ? [\n            _vm.addressDetail.province,\n            _vm.addressDetail.city,\n            _vm.addressDetail.county\n          ].join('/')\n        : '选择省/市/区',\"area-columns-placeholder\":['请选择', '请选择', '请选择'],\"save-button-text\":_vm.addressId ? '修改' : '添加'},on:{\"save\":_vm.onSave,\"change-area\":_vm.onChangeArea}})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"edit_add\">\r\n    <van-nav-bar\r\n      title=\"添加收货地址\"\r\n      left-arrow\r\n      @click-left=\"$router.back()\"\r\n    ></van-nav-bar>\r\n    <van-address-edit\r\n      class=\"myEdit\"\r\n      :address-info=\"addressDetail\"\r\n      :area-list=\"vantRegion\"\r\n      :show-set-default=\"!(addressId === defaultAddressId)\"\r\n      area-value=\"110000\"\r\n      :area-placeholder=\"\r\n        addressId\r\n          ? [\r\n              addressDetail.province,\r\n              addressDetail.city,\r\n              addressDetail.county\r\n            ].join('/')\r\n          : '选择省/市/区'\r\n      \"\r\n      :area-columns-placeholder=\"['请选择', '请选择', '请选择']\"\r\n      :save-button-text=\"addressId ? '修改' : '添加'\"\r\n      @save=\"onSave\"\r\n      @change-area=\"onChangeArea\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getRegion,\r\n  getAddressDetail,\r\n  editAddress,\r\n  addAddress,\r\n  setDefaultAddress,\r\n  getAddress\r\n} from '@/api/address'\r\nexport default {\r\n  name: 'editAndAdd',\r\n  data() {\r\n    return {\r\n      addressDetail: {},\r\n      region: {},\r\n      vantRegion: {},\r\n      regionId: 0\r\n    }\r\n  },\r\n  methods: {\r\n    async setRegion() {\r\n      const result = await getRegion()\r\n      this.region = result.data.list\r\n      console.log('region:')\r\n      console.log(this.region)\r\n      this.handleregion()\r\n    },\r\n    //将返回的数据格式转换为vant area 能显示的数据格式\r\n    handleregion() {\r\n      const vantRegion = {\r\n        province_list: {},\r\n        city_list: {},\r\n        county_list: {}\r\n      }\r\n      let province_code = 100000\r\n      for (let province in this.region) {\r\n        const provinceObj = this.region[province]\r\n        vantRegion.province_list[province_code] = provinceObj.name\r\n        let city_code = province_code + 100\r\n        for (let city in provinceObj.city) {\r\n          const cityObj = provinceObj.city[city]\r\n          vantRegion.city_list[city_code] = cityObj.name\r\n          let county_code = city_code + 1\r\n          for (let county in cityObj.region) {\r\n            const countyObj = cityObj.region[county]\r\n            vantRegion.county_list[county_code] = countyObj.name\r\n            county_code += 1\r\n          }\r\n          city_code += 100\r\n        }\r\n        province_code += 10000\r\n      }\r\n      console.log(vantRegion)\r\n      this.vantRegion = vantRegion\r\n\r\n      //设置一下\r\n    },\r\n    //将返回数据的格式变为vant2 area组件需求的格式\r\n    IdToVantId(province_id, city_id, region_id) {\r\n      //看是第几个province\r\n      let rank1 = 0\r\n      for (let i in this.region) {\r\n        if (i === province_id.toString()) break\r\n        rank1++\r\n      }\r\n      let rank2 = 0\r\n      for (let i in this.region[province_id.toString()].city) {\r\n        if (i === city_id.toString()) break\r\n        rank2++\r\n      }\r\n      console.log('city_id - province_id' + (city_id - province_id))\r\n      let result =\r\n        100000 + rank1 * 10000 + (rank2 + 1) * 100 + (region_id - city_id)\r\n      console.log('result' + result)\r\n      return result.toString()\r\n    },\r\n    //转换回\r\n    VantIdtoId(provinceName, cityName, countyName) {\r\n      let regionArray = []\r\n      for (let i in this.region) {\r\n        if (this.region[i].name === provinceName) {\r\n          regionArray[0] = {\r\n            value: i * 1,\r\n            lavel: provinceName\r\n          }\r\n          const city = this.region[i].city\r\n          for (let i1 in city) {\r\n            if (city[i1].name === cityName) {\r\n              regionArray[1] = {\r\n                value: i1 * 1,\r\n                lavel: cityName\r\n              }\r\n              const region = city[i1].region\r\n              for (let i2 in region) {\r\n                if (region[i2].name === countyName) {\r\n                  regionArray[2] = {\r\n                    value: i2 * 1,\r\n                    lavel: countyName\r\n                  }\r\n                  return regionArray\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    async setAddressForm() {\r\n      const { data } = await getAddressDetail(this.addressId)\r\n      console.log(data)\r\n      const d = data.detail\r\n      //将信息保存至表单绑定对象addressDetial\r\n      const obj = {}\r\n      obj.id = this.addressId\r\n      obj.name = d.name\r\n      obj.tel = d.phone\r\n      obj.province = d.region.province\r\n      obj.city = d.region.city\r\n      obj.county = d.region.region\r\n      obj.addressDetail = d.detail\r\n      obj.isDefault = this.addressId === this.defaultAddressId\r\n      const cal_area_id = this.IdToVantId(d.province_id, d.city_id, d.region_id)\r\n      console.log('cal_area_id:' + cal_area_id)\r\n      obj.areaCode = cal_area_id\r\n      this.addressDetail = obj\r\n      //单独设置最初的regionId\r\n      this.regionId = d.region_id\r\n\r\n      console.log(this.addressDetail)\r\n      // console.log(obj)\r\n      // obj.name = result.this.addressDetail\r\n    },\r\n    async onSave(content) {\r\n      console.log(content)\r\n\r\n      //获取到地址数组\r\n      const regionArray = this.VantIdtoId(\r\n        content.province,\r\n        content.city,\r\n        content.county\r\n      )\r\n      console.log('regionArray')\r\n      console.log(regionArray)\r\n\r\n      const data = {\r\n        form: {\r\n          name: content.name,\r\n          phone: content.tel,\r\n          region: regionArray,\r\n          detail: content.addressDetail\r\n        }\r\n      }\r\n\r\n      try {\r\n        if (!this.addressId) {\r\n          //如果是添加，发送添加收货地址请求\r\n          await addAddress(data)\r\n        } else {\r\n          //如果是修改，发送修改收货地址请求\r\n          data.addressId = this.addressId\r\n          await editAddress(data)\r\n        }\r\n        //如果设置该地址为默认地址\r\n        if (content.isDefault) {\r\n          if (!this.addressId) {\r\n            //如果是添加\r\n            //需先发送获取所有地址\r\n            const addressList = await getAddress().data.list\r\n            //遍历addressList,找到detail属性与content的addressDetail属性相等的项，返回其address_id属性的值\r\n            const addressId = addressList.find(\r\n              item => item.detail === content.addressDetail\r\n            ).address_id\r\n            setDefaultAddress(addressId)\r\n          } else {\r\n            //如果是修改\r\n            if (!this.addressId === this.defaultAddressId) {\r\n              //本来不是默认才需要发送\r\n              setDefaultAddress(this.addressId)\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.dir(error)\r\n      }\r\n\r\n      //还需发送设置默认地址请求\r\n      this.$router.push('/address')\r\n    },\r\n    onChangeDetail() {},\r\n    onChangeArea(e) {\r\n      console.log(e)\r\n    }\r\n  },\r\n  computed: {\r\n    addressId() {\r\n      return this.$route.query.id\r\n    },\r\n    defaultAddressId() {\r\n      return this.$route.query.defaultId\r\n    }\r\n  },\r\n  async created() {\r\n    await this.setRegion()\r\n    if (this.addressId) {\r\n      await this.setAddressForm()\r\n    }\r\n  },\r\n  mounted() {\r\n    // if (this.addressId) {\r\n    //   document\r\n    //     .querySelectorAll('input.van-field__control')\r\n    //     .forEach(item => item.classList.add('edit_add-realPlaceHolder'))\r\n    // }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n// .edit_add {\r\n//   .van-address-edit /deep/ .van-field__control::placeholder {\r\n//     color: black;\r\n//   }\r\n// }\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./edit_add.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./edit_add.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./edit_add.vue?vue&type=template&id=7dd69160&scoped=true\"\nimport script from \"./edit_add.vue?vue&type=script&lang=js\"\nexport * from \"./edit_add.vue?vue&type=script&lang=js\"\nimport style0 from \"./edit_add.vue?vue&type=style&index=0&id=7dd69160&prod&lang=less&scoped=true\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7dd69160\",\n  null\n  \n)\n\nexport default component.exports","import request from '@/utils/request'\r\n\r\n//获取收货地址\r\nexport const getAddress = () => {\r\n  return request.get('address/list')\r\n}\r\n\r\n//获取详细收货地址\r\nexport const getAddressDetail = addressId => {\r\n  return request.post('address/detail', {\r\n    addressId\r\n  })\r\n}\r\n\r\n//默认收货地址id\r\nexport const defaultAddress = () => {\r\n  return request.get('/address/defaultId')\r\n}\r\n\r\n//获取省市区\r\nexport const getRegion = () => {\r\n  return request.get('/region/tree')\r\n}\r\n\r\n//设置默认收货地址\r\nexport const setDefaultAddress = addressId => {\r\n  request.post('/address/setDefault', {\r\n    addressId\r\n  })\r\n}\r\n\r\n//添加收货地址\r\nexport const addAddress = data => {\r\n  request.post('/address/add', data)\r\n}\r\n\r\n//编辑收货地址\r\nexport const editAddress = data => {\r\n  request.post('/address/edit', data)\r\n}\r\n\r\n//删除收货地址\r\nexport const deleteAddress = addressId => {\r\n  request.post('/address/remove', { addressId })\r\n}\r\n"],"names":["render","_vm","this","_c","_self","staticClass","attrs","on","$event","$router","back","addressDetail","vantRegion","addressId","defaultAddressId","province","city","county","join","onSave","onChangeArea","staticRenderFns","name","data","region","regionId","methods","setRegion","result","getRegion","list","console","log","handleregion","province_list","city_list","county_list","province_code","provinceObj","city_code","cityObj","county_code","countyObj","IdToVantId","province_id","city_id","region_id","rank1","i","toString","rank2","VantIdtoId","provinceName","cityName","countyName","regionArray","value","lavel","i1","i2","setAddressForm","getAddressDetail","d","detail","obj","id","tel","phone","isDefault","cal_area_id","areaCode","content","form","editAddress","addAddress","setDefaultAddress","addressList","getAddress","find","item","address_id","error","dir","push","onChangeDetail","e","computed","$route","query","defaultId","created","mounted","component","request","get","post","defaultAddress","deleteAddress"],"sourceRoot":""}