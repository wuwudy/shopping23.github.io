"use strict";(self["webpackChunkshopping_mall23"]=self["webpackChunkshopping_mall23"]||[]).push([[127],{6127:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-page"},[e("van-nav-bar",{attrs:{title:"会员登录","left-arrow":""},on:{"click-left":t.onClickLeft}}),e("div",{staticClass:"container"},[e("h1",[t._v("手机号登录")]),e("h3",[t._v("未注册的手机号登录后将自动注册")]),e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.in_mobile,expression:"in_mobile"}],attrs:{type:"text",placeholder:"请输入手机号码"},domProps:{value:t.in_mobile},on:{input:function(e){e.target.composing||(t.in_mobile=e.target.value)}}})]),e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.in_picCode,expression:"in_picCode"}],attrs:{type:"text",placeholder:"请输入图形验证码"},domProps:{value:t.in_picCode},on:{input:function(e){e.target.composing||(t.in_picCode=e.target.value)}}}),t.pic?e("img",{attrs:{src:t.pic,alt:""},on:{click:function(e){return t.getPicCode()}}}):t._e(),t._v(t._s(t.pic)+" ")]),e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.in_msgCode,expression:"in_msgCode"}],attrs:{type:"text",placeholder:"请输入短信验证码"},domProps:{value:t.in_msgCode},on:{input:function(e){e.target.composing||(t.in_msgCode=e.target.value)}}}),e("button",{staticClass:"getmsgBtn",on:{click:t.getMsgCode}},[t._v(" "+t._s(null===t.timer?"获取验证码":"请查收("+t.count+")")+" ")])]),e("button",{staticClass:"login-btn",on:{click:t.login}},[t._v("登录")])])],1)},s=[],n=(i(4114),i(5720));const a=()=>n.A.get("/captcha/image",{platform:"H5"}),r=(t,e,i)=>n.A.post("/captcha/sendSmsCaptcha",{form:{captchaCode:t,captchaKey:e,mobile:i}}),l=(t,e)=>{const i={form:{smsCode:t,mobile:e,isParty:!1,partyData:{}}},o={method:"POST",url:"/passport/login",data:i};return(0,n.A)(o)};var c={name:"loginIndex",data(){return{in_mobile:"17700215825",in_picCode:"ztp3",in_msgCode:"246810",pic:"",picKey:"",totalcount:3,count:3,timer:null}},async created(){this.getPicCode(),console.log(this.forwardUrl)},computed:{forwardUrl(){return this.$route.query.forwardUrl}},methods:{async getPicCode(){const{data:{base64:t,key:e}}=await a();this.pic=t,this.picKey=e},async getMsgCode(){this.testInput()&&(this.timer||(this.timer=setInterval((()=>{console.log(this.count),this.count>0?this.count--:(clearInterval(this.timer),this.timer=null,this.count=this.totalcount)}),1e3),console.log("现在发送请求"),await r(this.in_picCode,this.picKey,this.in_mobile),this.$toast("短信已发送，注意查收")))},async login(){if(/^\d{6}$/.test(this.in_msgCode)){if(this.testInput()){const t=await l(this.in_msgCode,this.in_mobile);console.log("登录"),console.log(t),this.$store.commit("user/setUserInfo",t.data);const e=this.forwardUrl||"/home";this.$router.push(e)}}else this.$toast("验证码有误")},testInput(){return/^1[3-9]\d{9}$/.test(this.in_mobile)?(/^w{4}$/g.test(this.in_picCode)&&this.$toast("请输入正确的图形验证码"),!0):(this.$toast("请输入正确的手机号"),!1)},onClickLeft(){"/cart"===this.forwardUrl?this.$router.push("/"):this.$router.go(-1)}}},p=c,u=i(1656),d=(0,u.A)(p,o,s,!1,null,"17a45e36",null),m=d.exports}}]);
//# sourceMappingURL=127.d72b2927.js.map